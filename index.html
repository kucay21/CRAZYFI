<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Crazy Snake - Home</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { --bg:#000; --panel:#111; --muted:#999; --accent:#22c55e; }
    body{margin:0;background:var(--bg);color:#fff;font-family:Arial, sans-serif;}
    header{display:flex;justify-content:space-between;align-items:center;padding:10px 16px;background:var(--panel);position:relative;z-index:10;}
    .brand{font-weight:700;}
    .menu-btn{font-size:28px;cursor:pointer}
    nav.menu{display:none;flex-direction:column;background:#0f1720;position:absolute;top:56px;left:0;width:100%;z-index:9;border-top:1px solid #0b1220}
    nav.menu a{padding:14px 16px;text-decoration:none;color:#fff;border-bottom:1px solid #0b1220}
    nav.menu a:hover{background:#0b1220}
    .btn{background:var(--accent);color:#051014;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
    .small-btn{background:transparent;border:1px solid #2d3b33;color:var(--accent);padding:6px 8px;border-radius:6px;cursor:pointer}
    .banner{width:100%;max-height:360px;overflow:hidden;display:block}
    .banner img{width:100%;height:auto;display:block;object-fit:cover}
    .center{text-align:center;padding:20px}
    .addr{font-weight:700;color:#9ae6b4}
    .wallet-actions{display:flex;gap:8px;align-items:center}
    input.readonly {width:90%;padding:8px;text-align:center;background:#111;border:1px solid #333;color:#9ae6b4;border-radius:6px;}
    @media(min-width:768px){
      nav.menu{position:static;display:flex;flex-direction:row;background:transparent;border-top:0}
      nav.menu a{border-bottom:0;padding:8px 12px}
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">Crazy Snake</div>
    <div class="wallet-actions">
      <div id="addrDisplay" style="margin-right:10px;"></div>
      <button id="connectBtn" class="btn">Connect Wallet</button>
      <span class="menu-btn" onclick="toggleMenu()">â˜°</span>
    </div>
  </header>

  <nav class="menu" id="menu">
    <a href="index.html">Home</a>
    <a href="staking.html">Staking</a>
    <a href="marketplace.html">Marketplace</a>
    <a href="whitepaper.html">Whitepaper</a>
    <a href="guide.html">Guide</a>
    <a href="setting.html">Setting</a>
    <a href="#" onclick="connectFromMenu(event)">Connect Wallet</a>
  </nav>

  <main>
    <div class="banner">
      <img src="https://raw.githubusercontent.com/kucay21/Crazy_snake_asset/main/file_00000000fe0c61f78bcdbf30f58bf219.png" alt="Crazy Snake Banner">
    </div>
    <div class="center">
      <h1>Welcome to Crazy Snake</h1>
      <p style="color:var(--muted)">Play, stake, and earn with the craziest snake on-chain!</p>
      <div style="margin-top:14px">
        <button class="btn" onclick="startGame()">Play Now</button>
      </div>
    </div>

    <!-- Referral Section -->
    <section class="center" style="margin-top:30px;">
      <h2>Referral</h2>
      <p>Bagikan link ini ke temanmu:</p>
      <input id="refLink" class="readonly" readonly />
      <p id="refSaved" style="color:var(--muted);margin-top:8px;"></p>
    </section>

    <!-- Unstake Section -->
    <section class="center" style="margin-top:30px;">
      <h2>Unstake NFT</h2>
      <p>Lepas NFT kamu dari staking (dummy button, nanti bisa dihubungkan ke smart contract):</p>
      <button class="btn" onclick="unstakeNFT()">Unstake Now</button>
      <p id="unstakeMsg" style="color:var(--muted);margin-top:8px;"></p>
    </section>
  </main>

  <!-- Ethers minimal -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
  <script>
    const connectBtn = document.getElementById('connectBtn');
    const addrDisplay = document.getElementById('addrDisplay');
    const menu = document.getElementById('menu');

    function toggleMenu(){ 
      menu.style.display = (menu.style.display === 'flex' || menu.style.display === 'block') ? 'none' : (window.innerWidth >= 768 ? 'flex' : 'block'); 
    }

    function short(addr){ if(!addr) return ''; return addr.slice(0,6) + '...' + addr.slice(-4); }
    function setAddressUI(addr){
      if(addr){
        addrDisplay.innerHTML = '<span class="addr">'+short(addr)+'</span>';
        connectBtn.textContent = 'Disconnect';
        connectBtn.onclick = disconnect;
        localStorage.setItem('cs_address', addr);
        updateReferralUI(addr);
      } else {
        addrDisplay.textContent = '';
        connectBtn.textContent = 'Connect Wallet';
        connectBtn.onclick = connectWallet;
        localStorage.removeItem('cs_address');
        updateReferralUI(null);
      }
    }

    async function connectWallet(){
      try{
        if(!window.ethereum){ alert('No wallet found'); return; }
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        const addr = accounts[0];
        setAddressUI(addr);
      }catch(e){ console.error(e); alert('Gagal connect wallet: '+e.message); }
    }

    function disconnect(){ setAddressUI(null); }
    function connectFromMenu(e){ e.preventDefault(); connectWallet(); if(window.innerWidth<768) menu.style.display='none'; }

    // ---------- Referral ----------
    function saveReferral(){
      const params = new URLSearchParams(window.location.search);
      const ref = params.get("ref");
      if(ref){
        localStorage.setItem("cs_referral", ref);
        console.log("Referral saved:", ref);
      }
    }
    function getReferral(){ return localStorage.getItem("cs_referral") || null; }

    function updateReferralUI(addr){
      const refLink = document.getElementById("refLink");
      const refSaved = document.getElementById("refSaved");
      if(!refLink) return;

      if(addr){
        refLink.value = window.location.origin + window.location.pathname + "?ref=" + addr;
      } else {
        refLink.value = "";
      }
      const saved = getReferral();
      if(saved){
        refSaved.textContent = "You were referred by: " + saved.slice(0,6)+"..."+saved.slice(-4);
      } else {
        refSaved.textContent = "";
      }
    }

    // ---------- Unstake Dummy ----------
    function unstakeNFT(){
      const msg = document.getElementById("unstakeMsg");
      msg.textContent = "Unstake process triggered (dummy).";
      console.log("Unstake NFT clicked");
      // nanti tinggal panggil smart contract di sini
    }

    function startGame(){ alert('Play now! (placeholder)'); }

    // ---------- INIT ----------
    (function init(){
      saveReferral();
      const stored = localStorage.getItem('cs_address');
      if(stored){ setAddressUI(stored); } else { setAddressUI(null); }
    })();
  </script>
</body>
</html>