<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Marketplace - Crazy Snake</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    :root{--bg:#000;--panel:#111;--accent:#22c55e}
    body{margin:0;background:var(--bg);color:#fff;font-family:Arial, sans-serif}
    header{display:flex;justify-content:space-between;align-items:center;padding:10px 16px;background:var(--panel)}
    .menu-btn{font-size:28px;cursor:pointer}
    nav.menu{display:none;flex-direction:column;background:#0f1720;position:absolute;top:56px;left:0;width:100%}
    nav.menu a{padding:14px 16px;color:#fff;text-decoration:none;border-bottom:1px solid #0b1220}
    main{padding:18px}
    .item{background:#0b1220;padding:12px;margin-bottom:12px;border-radius:8px}
    .btn{background:var(--accent);color:#051014;padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
  </style>
</head>
<body>
  <header>
    <div class="brand">Crazy Snake</div>
    <div>
      <span id="addrDisplay"></span>
      <button id="connectBtn" class="btn">Connect Wallet</button>
      <span class="menu-btn" onclick="toggleMenu()">☰</span>
    </div>
  </header>

  <nav class="menu" id="menu">
    <a href="index.html">Home</a>
    <a href="staking.html">Staking</a>
    <a href="marketplace.html">Marketplace</a>
    <a href="whitepaper.html">Whitepaper</a>
    <a href="guide.html">Guide</a>
    <a href="setting.html">Setting</a>
    <a href="#" onclick="connectFromMenu(event)">Connect Wallet</a>
  </nav>

  <main>
    <h1>Marketplace</h1>
    <p style="color:#9ca3af">Buy / sell game items (demo UI)</p>

    <div class="item">
      <h3>Snake Skin - Neon</h3>
      <p>Price: 100 CST</p>
      <button class="btn" onclick="buy('Snake Skin - Neon')">Buy</button>
    </div>

    <div class="item">
      <h3>Power Boost</h3>
      <p>Price: 50 CST</p>
      <button class="btn" onclick="buy('Power Boost')">Buy</button>
    </div>

    <p><a href="index.html" style="color:#60a5fa">⬅ Back to Home</a></p>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
  <script>
    const BASE_CHAIN_ID_HEX = '0x2105';
    const BASE_CHAIN_PARAMS = { chainId: BASE_CHAIN_ID_HEX, chainName: 'Base Mainnet', nativeCurrency:{name:'Ether',symbol:'ETH',decimals:18}, rpcUrls:['https://mainnet.base.org'], blockExplorerUrls:['https://base.blockscout.com/'] };

    const connectBtn = document.getElementById('connectBtn');
    const addrDisplay = document.getElementById('addrDisplay');
    const menu = document.getElementById('menu');

    function toggleMenu(){ menu.style.display = (menu.style.display === 'flex' || menu.style.display === 'block') ? 'none' : (window.innerWidth >= 768 ? 'flex' : 'block'); }

    function short(addr){ if(!addr) return ''; return addr.slice(0,6) + '...' + addr.slice(-4); }
    function setAddressUI(addr){
      if(addr){ addrDisplay.innerHTML = '<strong style="color:#9ae6b4">'+short(addr)+'</strong>'; connectBtn.textContent='Disconnect'; connectBtn.onclick=disconnect; localStorage.setItem('cs_address', addr); }
      else { addrDisplay.textContent=''; connectBtn.textContent='Connect Wallet'; connectBtn.onclick=connectWallet; localStorage.removeItem('cs_address'); }
    }

    async function connectWallet(){
      try {
        if(!window.ethereum){ alert('No injected wallet found.'); return; }
        const accs = await window.ethereum.request({ method: 'eth_requestAccounts' });
        const addr = accs[0];
        const chainId = await window.ethereum.request({ method: 'eth_chainId' });
        if(chainId !== BASE_CHAIN_ID_HEX){
          try { await window.ethereum.request({ method:'wallet_switchEthereumChain', params:[{ chainId: BASE_CHAIN_ID_HEX }] }); }
          catch(s){ if(s && s.code===4902) await window.ethereum.request({ method:'wallet_addEthereumChain', params:[BASE_CHAIN_PARAMS] }); }
        }
        window.cs_provider = new ethers.providers.Web3Provider(window.ethereum);
        window.cs_signer = window.cs_provider.getSigner();
        setAddressUI(addr);
        window.ethereum.on('accountsChanged',(a)=>{ if(a && a.length) setAddressUI(a[0]); else setAddressUI(null); });
        window.ethereum.on('chainChanged',()=>setTimeout(()=>location.reload(),200));
      } catch(e){ console.error(e); alert('Connect failed: '+(e.message||e)); }
    }

    function disconnect(){ setAddressUI(null); try{ window.ethereum && window.ethereum.removeListener && window.ethereum.removeListener('accountsChanged',()=>{}); }catch(e){} }
    function connectFromMenu(e){ e.preventDefault(); connectWallet(); if(window.innerWidth<768) menu.style.display='none'; }

    (function(){ const s=localStorage.getItem('cs_address'); if(s) setAddressUI(s); else setAddressUI(null); })();

    function buy(item){ if(!localStorage.getItem('cs_address')) return alert('Connect wallet dulu'); alert('Buy request (demo): '+item); }
  </script>
</body>
</html>